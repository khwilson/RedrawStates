<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <style>
.blue-state {
  color: #179ee0;
  font-weight: bold;
}

.red-state {
  color: #ff5d40;
  font-weight: bold;
}

.share-box:after {
    content: "Copy to clipboard";
    position: absolute;
    top: 0;
    left: 0;
    padding: 2px 8px;
    font-size: 12px;
    font-weight: bold;
    background-color: #f5f5f5;
    color: #9da0a4;
    border-radius: 4px 0 4px 0;
}

.btn-space {
  margin-top: 3px;
  margin-bottom: 3px;
}

.share-box {
    position: relative;
    margin: 15px 0 0;
    padding: 39px 19px 14px;
    background-color: #fff;
    border-radius: 4px 4px 0 0;
    border: 1px solid #ddd;
    z-index: 2;
}
      h2.instructions {
        font-size: 14px;
        font-weight: bold;
      }

      p.instructions {
        line-height: 16px;
        font-size: 12px;
      }

      .dem-95 { fill: rgb(42,161,236); stroke: #ccf; stroke-width: .5px; }
      .dem-90 { fill: rgb(79,169,238); stroke: #ccf; stroke-width: .5px; }
      .dem-85 { fill: rgb(105,178,240); stroke: #ccf; stroke-width: .5px; }
      .dem-80 { fill: rgb(125,185,242); stroke: #ccf; stroke-width: .5px; }
      .dem-75 { fill: rgb(144,194,243); stroke: #ccf; stroke-width: .5px; }
      .dem-70 { fill: rgb(162,203,245); stroke: #ccf; stroke-width: .5px; }
      .dem-65 { fill: rgb(178,211,247); stroke: #ccf; stroke-width: .5px; }
      .dem-60 { fill: rgb(194,220,249); stroke: #ccf; stroke-width: .5px; }
      .dem-55 { fill: rgb(210,228,250); stroke: #ccf; stroke-width: .5px; }
      .dem-50 { fill: rgb(226,237,252); stroke: #ccf; stroke-width: .5px; }
      .dem-less-than-50 { fill: rgb(255,255,255); stroke: #ccf; stroke-width: .5px; }

      .dem-0 { fill: rgb(254,106,89); stroke: #fcc; stroke-width: .5px; }
      .dem-5 { fill: rgb(255,122,104); stroke: #fcc; stroke-width: .5px; }
      .dem-10 { fill: rgb(255,139,120); stroke: #fcc; stroke-width: .5px; }
      .dem-15 { fill: rgb(255,153,135); stroke: #fcc; stroke-width: .5px; }
      .dem-20 { fill: rgb(255,167,150); stroke: #fcc; stroke-width: .5px; }
      .dem-25 { fill: rgb(255,180,166); stroke: #fcc; stroke-width: .5px; }
      .dem-30 { fill: rgb(255,194,181); stroke: #fcc; stroke-width: .5px; }
      .dem-35 { fill: rgb(255,206,196); stroke: #fcc; stroke-width: .5px; }
      .dem-40 { fill: rgb(255,219,210); stroke: #fcc; stroke-width: .5px; }
      .dem-45 { fill: rgb(255,231,225); stroke: #fcc; stroke-width: .5px; }
      .dem-greater-than-50 { fill: #fff; stroke: #fcc; stroke-width: .5px; }

      .dem-95-state { fill: rgb(42,161,236); stroke: #000; stroke-width: .5px; }
      .dem-90-state { fill: rgb(79,169,238); stroke: #000; stroke-width: .5px; }
      .dem-85-state { fill: rgb(105,178,240); stroke: #000; stroke-width: .5px; }
      .dem-80-state { fill: rgb(125,185,242); stroke: #000; stroke-width: .5px; }
      .dem-75-state { fill: rgb(144,194,243); stroke: #000; stroke-width: .5px; }
      .dem-70-state { fill: rgb(162,203,245); stroke: #000; stroke-width: .5px; }
      .dem-65-state { fill: rgb(178,211,247); stroke: #000; stroke-width: .5px; }
      .dem-60-state { fill: rgb(194,220,249); stroke: #000; stroke-width: .5px; }
      .dem-55-state { fill: rgb(210,228,250); stroke: #000; stroke-width: .5px; }
      .dem-50-state { fill: rgb(226,237,252); stroke: #000; stroke-width: .5px; }

      .dem-0-state { fill: rgb(254,106,89); stroke: #000; stroke-width: .5px; }
      .dem-5-state { fill: rgb(255,122,104); stroke: #000; stroke-width: .5px; }
      .dem-10-state { fill: rgb(255,139,120); stroke: #000; stroke-width: .5px; }
      .dem-15-state { fill: rgb(255,153,135); stroke: #000; stroke-width: .5px; }
      .dem-20-state { fill: rgb(255,167,150); stroke: #000; stroke-width: .5px; }
      .dem-25-state { fill: rgb(255,180,166); stroke: #000; stroke-width: .5px; }
      .dem-30-state { fill: rgb(255,194,181); stroke: #000; stroke-width: .5px; }
      .dem-35-state { fill: rgb(255,206,196); stroke: #000; stroke-width: .5px; }
      .dem-40-state { fill: rgb(255,219,210); stroke: #000; stroke-width: .5px; }
      .dem-45-state { fill: rgb(255,231,225); stroke: #000; stroke-width: .5px; }

  .ev-bar {
    width: 100%;
    height: 25px;
  }

  .ev-bar:after {
    content: "";
    position: absolute;
    z-index=-1;
    top: 0;
    bottom: 0;
    left: 50%;
    border-left: 2px solid #000;
  }

  .ev-bar-dem-total {
    float: left;
    padding: 4px;
    font-size: 16px;
    font-weight: bold;
    color: #fff;
    stroke: #000;
    stroke-width: .5px;
  }

  .ev-bar-gop-total {
    float: right;
    padding: 4px;
    font-size: 16px;
    font-weight: bold;
    color: #fff;
    stroke: #000;
    stroke-width: .5px;
  }

    .state-boundary-filled {
      fill: none;
      stroke: #000;
      stroke-width: 1px;
    }

    .selection-color {
      fill: #f0f;
      stroke: #000;
      stroke-width: .5px;
    }

    .dem-95:hover,
    .dem-90:hover,
    .dem-85:hover,
    .dem-80:hover,
    .dem-75:hover,
    .dem-70:hover,
    .dem-65:hover,
    .dem-60:hover,
    .dem-55:hover,
    .dem-50:hover,
    .dem-45:hover,
    .dem-40:hover,
    .dem-35:hover,
    .dem-30:hover,
    .dem-25:hover,
    .dem-20:hover,
    .dem-15:hover,
    .dem-10:hover,
    .dem-5:hover,
    .dem-0:hover,
    .dem-less-than-50:hover,
    .dem-greater-than-50:hover {
      fill: #0ff;
    }

    .hidden {
        display: none;
    }
      div.tooltip {
      display: block;
      opacity: 0.95;
      pointer-events: none;
      z-index: 999;
      border: 1px solid #ddd;
      padding: 0px 2px;
      background-color: #FFF;
    }

    h2.tooltip-title-heading {
     font-size: 14px;
     font-weight: normal;
     padding: 0 0 0 0;
     margin: 10px 5px 0px 0px;
     text-align: left;
     text-transform: uppercase;
    }

    table.county-results {
      background-color: transparent;
      font-size: 12px;
      color: #333;
      margin-bottom: 3px;
      text-align: left;
      border-top: 0;
      padding: 4px 10px;
    }

    table.county-results>tbody>tr>td {
      background-color: transparent;
      font-size: 10px;
      color: #333;
      margin-bottom: 3px;
      text-align: left;
      border-top: 0;
      padding: 4px 10px;
    }

    .tooltip-inner {
      max-width: 200px;
      padding: 0px;
      color: #333;
      background-color: transparent;
    }
    </style>
  </head>
<body>

<div class="input-group" id="shareGroup">
  <input type="text" class="form-control" value="http://woot.com" onclick="this.select();" id="clipboard-target" readonly>
  <span class="input-group-btn">
    <button id="copy-button" class="btn btn-secondary" data-clipboard-tooltip data-clipboard-target="#clipboard-target" type="button"><img src="clippy.svg" width="14"></button>
  </span>
</div>

<div class="container">
  <div class="row">
    <div class="col-sm-12">
      <div class="ev-bar">
        <div class='ev-bar-dem-total'></div>
        <div class='ev-bar-gop-total'></div>
      </div>
    </div>
  </div>
  <div class="row">
     <div class="col-sm-10">
       <svg id='states-svg'></svg>
     </div>
     <div class="col-sm-2">
      <div class="row">
        <div class="col-sm-12">
          <h2 class="instructions">Instructions</h2>
          <p class="instructions">How few counties can you move to make Hillary Clinton win the 2016 election?</p>
          <p class="instructions">Choose a county (or several) to move to a new state. Then click the <b>Move</b> button and the state you want to move your counties to.</p>
          <p class="instructions">We'll automatically recompute the number of electoral votes the state would get with their new counties, and update the electoral vote. However, we don't account for Maine and Nebraska's splitting of votes by congressional district.</p>
          <p class="instructions">Weep at <a href="https://medium.com/@khayeswilson/clinton-would-have-won-if-the-united-states-looked-like-this-7b9c844b76a9">how arbitrary our electoral system is<a/>.</p>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <button type="button" class="btn btn-danger btn-md btn-block btn-space" id="switchModeButton">Move</button>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <button type="button" class="btn btn-primary btn-md btn-block btn-space" id="countyModeButton">Hide Colors</button>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12">
          <a tabindex=0 role="button" class="btn btn-primary btn-md btn-block btn-space" id="shareButton">Share</a>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <table class="table table-striped">
        <thead>
          <td>State</td>
          <td>Population</td>
          <td>Electors</td>
          <td>Democrat</td>
          <td>GOP</td>
          <td>Green</td>
          <td>Libertarian</td>
          <td>Evan</td>
          <td>Other</td>
        </thead>
        <tbody id="states"></tbody>
      </table>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-12">
      Code available on <a href="https://github.com/khwilson/RedrawStates">GitHub</a>.
      County election data compiled by <a href="http://townhall.com">Townhall</a>.
      More acknowledgments available on GitHub.
      Copyright 2016 Kevin Hayes Wilson.
    </div>
  </div>
</div>

<script src="js/d3.v3.min.js"></script>
<script src="js/topojson.v1.min.js"></script>
<script>

var partyToCandidate = {
  'dem': 'Hillary Clinton',
  'gop': 'Donald Trump',
  'grn': "Jill Stein",
  'lib': 'Gary Johnson',
  'una': 'Evan McMullin',
  'oth': 'Other'
}

var numberToLetter = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',
                      'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];

var letterToNumber = {};
for (let i=0; i<numberToLetter.length; ++i) {
  letterToNumber[numberToLetter[i]] = i;
}

var us = null;

var currentMode = 'pickup';
var countyMode = 'show';
var showStateColors = true;

var switchModeButton = d3.select('#switchModeButton').html('Move');
var switchModeFunction = function() {
  if (currentMode === 'pickup') {
    switchModeButton.html('Cancel move').classed('btn-danger', false).classed('btn-warning', true);
    currentMode = 'dropoff';
  } else {
    switchModeButton.html('Move').classed('btn-danger', true).classed('btn-warning', false);
    currentMode = 'pickup';
  }
}
switchModeButton.on('click', switchModeFunction);

var countyModeButton = d3.select("#countyModeButton").html("Hide Counties");
var countyModeFunction = function () {
  if (countyMode === 'show') {
    countyMode = 'hide';
    countyModeButton.html("Outlines Only");
    d3.selectAll("path").remove();
    update();
  } else if (countyMode === 'hide' && showStateColors) {
    showStateColors = false;
    countyModeButton.html("Show Counties");
    d3.selectAll("path").remove();
    update();
  } else {
    countyMode = 'show';
    showStateColors = true;
    countyModeButton.html("Hide Counties");
    d3.selectAll("path").remove();
    update();
  }
}
countyModeButton.on('click', countyModeFunction);

var width = 960;
    height = 500;

var path = d3.geo.path();

var tooltip = d3.select('body').append('div')
            .attr('class', 'hidden tooltip');

var tooltipInner = tooltip.append('div').attr('class', 'tooltip-inner');
var tooltipTitle = tooltipInner.append('div').attr('class', 'tooltip-title');
var tooltipTable = tooltipInner.append('div').attr('class', 'tooltip-content').append('table').attr('class', 'table county-results');
var tooltipTr = tooltipTable.append('thead').append('tr')
tooltipTr.append('th').html('Candidate');
tooltipTr.append('th').html('Votes');
tooltipTr.append('th').html('Pct.');
var tooltipTbody = tooltipTable.append('tbody');

var svg = d3.select("#states-svg").attr('width', '100%').attr('viewBox', '0 0 ' + width + ' ' + height);

var countyToState = {}
var stateTotals = {}

var STATE_ABBREVS = [
  'AL', 'AK',
  'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'DC', 'FL',
  'GA', 'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME',
  'MD', 'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH',
  'NJ', 'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI',
  'SC', 'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI',
  'WY'];

var stateToNumber = {};
for (let i=0; i<STATE_ABBREVS.length; ++i) {
  stateToNumber[STATE_ABBREVS[i]] = i;
}

var computeElectors = function() {
  let priorities = [];
  let allocated = 153;
  for (let state of STATE_ABBREVS) {
    stateTotals[state].electors = 3;
    if (state !== 'DC' && state !== 'AK') {
      priorities.push({key: state, val: stateTotals[state].population / Math.sqrt(2)});
    }
  }
  priorities.sort(function(a, b) {
    if (a.val === b.val) {
      return 0;
    }
    return a.val < b.val ? 1 : -1;
  });
  while (allocated < 538) {
    let nextUp = priorities[0];
    let nextState = stateTotals[nextUp.key];
    nextState.electors += 1;
    allocated += 1;
    nextUp.val = nextState.population / Math.sqrt((nextState.electors - 2) * (nextState.electors - 1));
    priorities.sort(function(a, b) {
      if (a.val === b.val) {
        return 0;
      }
      return a.val < b.val ? 1 : -1;
    });
  }
}

var hasOrZero = function(obj, prop) {
  if (obj.hasOwnProperty(prop)) {
    return obj[prop];
  } else {
    return 0;
  }
}

var getColorClass = function(d) {
        if (d.properties.hasOwnProperty('state')) {
          let s = stateTotals[d.properties.state];
          if (s.dem > s.gop) {
            let demPercent = Math.floor(d.properties.dem / (d.properties.gop + d.properties.dem) * 20) * 5;
            if (demPercent < 50) {
              demPercent = 'less-than-50';
            }
            return 'dem-' + demPercent;
          } else {
            let demPercent = Math.floor(d.properties.dem / (d.properties.gop + d.properties.dem) * 20) * 5;
            if (demPercent >= 50) {
              demPercent = 'greater-than-50';
            }
            return 'dem-' + demPercent;
          }
        } else {
          return "black";
        }
      }
var intWithCommas = function(d) {
  return d.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

var update = function() {
  computeElectors();
  var tr = d3.select('#states')
    .selectAll("tr")
      .data(STATE_ABBREVS);

  tr.enter().append("tr");
  var td = tr.selectAll("td")
        .data(function (d, i) {
          let state = stateTotals[STATE_ABBREVS[i]];
          return [STATE_ABBREVS[i], state.population, state.electors, state.dem, state.gop, state.grn, state.lib, state.una, state.oth];
        })
  td.enter()
    .append("td")
  td.text(function (d, i) { return intWithCommas(d); })
    .attr("class", function(d, i) {
      if (i === 0) {
        return stateTotals[d].dem > stateTotals[d].gop ? "blue-state" : "red-state";
      } else {
        return null;
      }
    });
  td.exit().remove();
  tr.exit().remove();

  let mapPath;

  if (countyMode === 'show') {
    mapPath = svg.selectAll("path.county-path")
     .data(topojson.feature(us, us.objects.counties).features);

  mapPath
     .enter().append("path")
     .attr("d", path)
     .on("click", function(d) {
        if (currentMode === 'pickup') {
          let me = d3.select(this);
          if (me.classed('selection-color')) {
            me.classed(getColorClass(d), true);
            me.classed("selection-color", false);
          } else {
            me.classed(getColorClass(d), false);
            me.classed("selection-color", true);
          }
        } else if (currentMode === 'dropoff') {
          let newState = d.properties.state;
          let newStateData = stateTotals[newState];
          d3.selectAll("path.selection-color")
            .each(function(dd) {
              let oldState = dd.properties.state;
              dd.properties.state = newState;
              let oldStateData = stateTotals[oldState];
              for (let key of ['population', 'electors', 'dem', 'gop', 'lib', 'grn', 'una', 'oth']) {
                newStateData[key] += hasOrZero(dd.properties, key);
                oldStateData[key] -= hasOrZero(dd.properties, key);
              }
            });
          update();
          switchModeFunction();
        }
      })
     .on('mousemove', function(d) {
       var mouse = d3.mouse(svg.node()).map(function(d) {
        return parseInt(d);
       });
       tooltip.classed('hidden', false)
         .attr('style', 'left:' + (d3.event.pageX + 15) + 'px; top:' + (d3.event.pageY - 15) + 'px');
       })
     .on('mouseover', function(d) {
       let theHeading = tooltipTitle.selectAll("h2").data([d.properties.name])
       theHeading.enter().append("h2").attr('class', 'tooltip-title-heading');
       theHeading.html(function(dd) { return dd; });
       let thisData = [];
       let total = 0;
       for (let party in partyToCandidate) {
         let partyTotal = hasOrZero(d.properties, party);
         if (partyTotal > 0) {
           thisData.push([partyToCandidate[party], partyTotal]);
           total += partyTotal;
         }
       }
       let theData = tooltipTbody.selectAll("tr")
         .data(thisData);
       theData.enter().append('tr')
       let theRow = theData.selectAll("td").data(function(dd, i) {
         return [dd[0], dd[1], (100 * dd[1] / total).toFixed(2) + '%'];
       });
       theRow.enter().append('td');
       theRow.html(function(elt, i) { return i === 0 ? elt : intWithCommas(elt); })
       theRow.exit().remove();
       theData.exit().remove();
     })
     .on('mouseout', function() {
       tooltip.classed('hidden', true);
     });
  mapPath.attr("class", function(d) { return "county-path " + getColorClass(d); })

  }

  let demTotal = 0;
  let gopTotal = 0;

  mapPath = svg.selectAll("path.state-boundary")
    .data(d3.nest()
            .key(function(d) { return d.hasOwnProperty('properties') ? (d.properties.state || 'other') : 'other'; })
            .entries(us.objects.counties.geometries));

  mapPath.enter().append("path")
    .attr("class", "state-boundary state-boundary-filled");

  mapPath.attr("d", function(d) { return path(topojson.merge(us, d.values)); });
  if (countyMode === 'hide' && showStateColors) {
    mapPath.attr('class', function (d) {
      if (stateTotals.hasOwnProperty(d.key)) {
        let s = stateTotals[d.key];
        let dem = hasOrZero(s, 'dem');
        let gop = hasOrZero(s, 'gop');
        let demPercent = Math.floor(dem / (dem + gop) * 20) * 5;
        return "state-boundary dem-" + demPercent + '-state';
      } else {
        return 'state-boundary';
      }
    });
  }

  let count = 0;
  for (let state of STATE_ABBREVS) {
    count += 1;
    let s = stateTotals[state];
    if (s.dem > s.gop) {
      demTotal += s.electors;
    } else {
      gopTotal += s.electors;
    }
  }

  d3.select('.ev-bar').attr('style', 'background: linear-gradient(to right, #179ee0 0%, #179ee0 ' + (demTotal / 538 * 100) + '%, #ff5d40 ' + (demTotal / 538 * 100) + '%, #ff5d40 100%)');
  $(".ev-bar-dem-total").text(demTotal);
  $(".ev-bar-gop-total").text(gopTotal);
}

var getParameterByName = function (name, url) {
    if (!url) {
      url = window.location.href;
    }
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}

var getShareUrl = function() {
  us.objects.counties.geometries.sort(function(x, y) {
    if (x.id < y.id) {
      return -1;
    } else if (x.id > y.id) {
      return 1;
    } else {
      return 0;
    }
  });
  shareUrl = [];
  for (let geom of us.objects.counties.geometries) {
    if (geom.hasOwnProperty('properties')) {
      shareUrl.push(numberToLetter[stateToNumber[geom.properties.state]]);
    } else {
      shareUrl.push(numberToLetter[51]);
    }
  }
  return window.location.origin + window.location.pathname + '?share=' + shareUrl.join('');
}


var doShare = function() {
  d3.select("#clipboard-target").attr("value", getShareUrl());
}

d3.json("data/us.json", function(error, usData) {
  if (error) throw error;
  us = usData;

  let shareParameter = getParameterByName('share');
  if (shareParameter) {
    us.objects.counties.geometries.sort(function(x, y) {
      if (x.id < y.id) {
        return -1;
      } else if (x.id > y.id) {
        return 1;
      } else {
        return 0;
      }
    });
    for (let i=0; i<shareParameter.length; ++i) {
      let num = letterToNumber[shareParameter[i]];
      let geom = us.objects.counties.geometries[i];
      if (!geom) {
        console.log("problem ", i);
      }
      if (num !== 51 && geom && geom.hasOwnProperty('properties')) {
        geom.properties.state = STATE_ABBREVS[num];
      }
    }
  }

  for (let i=0; i<us.objects.counties.geometries.length; ++i) {
    let county = us.objects.counties.geometries[i];
    if (!county.hasOwnProperty('properties') || !county.properties.hasOwnProperty("state")) {
      // There are a few numbers in the 72000s which appear to be part of nothing in particular.
      continue;
    }
    countyToState[county.id] = county.properties.state;
    let state;
    if (stateTotals.hasOwnProperty(county.properties.state)) {
      state = stateTotals[county.properties.state];
    } else {
      state = {population: 0, electors: 0, color: county.properties.color, dem: 0, gop: 0, grn: 0, lib: 0, una: 0, oth: 0};
      stateTotals[county.properties.state] = state;
    }
    state.population += hasOrZero(county.properties, 'population');
    state.dem += hasOrZero(county.properties, 'dem');
    state.gop += hasOrZero(county.properties, 'gop');
    state.grn += hasOrZero(county.properties, 'grn');
    state.lib += hasOrZero(county.properties, 'lib');
    state.una += hasOrZero(county.properties, 'una');
    state.oth += hasOrZero(county.properties, 'oth');
  }

  update();

});

$("#shareGroup").hide();

$("#shareButton").popover({
  container: 'body',
  content: $("#shareGroup"),
  title: "Copy URL to Share",
  html: true,
  placement: "left",
  trigger: "focus"
}).on('show.bs.popover', function() { doShare(); $("#shareGroup").show(); });

var clipboard = new Clipboard('[data-clipboard-tooltip]');
clipboard.on('success', function(e) {
  e.clearSelection();
  console.info('Action:', e.action);
  console.info('Text:', e.text);
  console.info('Trigger:', e.trigger);
  //e.trigger.setAttribute('class', 'btn tooltipped tooltipped-s');
  //e.trigger.setAttribute('aria-label', msg);
});

</script>

</html>
